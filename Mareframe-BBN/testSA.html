<html>
<head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    <link href="css/SA.css" rel="stylesheet" />
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <script src="css/SA.css"></script>
    <script type="text/javascript">
        google.charts.load('current', { packages: ['corechart', 'table'] });
        google.charts.setOnLoadCallback(init);

        var pointCurrent;
        var pointOld = null;
        //var pwlDataArray =  [['xx', 'yy'],[2005, 1000 ],[2006, 3000 ],[2007, 1500 ],[2008,500],[2009, 1800 ],[2010, 2000]];
        var pwlDataArray = [['xx', 'yy', { role: 'annotation' }], [2005, 1000, null], [2006, 3000, null], [2007, 1500, null], [2008, 500, null], [2009, 1800, null], [2010, 2000, null]];
        var altData = [['Alt', 'Value'], ['car1', 0.345], ['car2', 0.145], ['car3', 0.395], ['car4', 0.765]];
        var lineOptions = {
            hAxis: {
                title: 'Time', minValue: pwlDataArray[1][0], maxValue: pwlDataArray[pwlDataArray.length - 1][0]
            },
            vAxis: {
                title: 'Popularity'
            },
            lineWidth: 1,
            height: 400,
            width: 400
        }
        var tableOptions = {
            height: 400,
            width: 400
        }
        var lc; // linechart 
        var tc; // tablechart
        function draw() {
            var pwlData = new google.visualization.arrayToDataTable(pwlDataArray);
            var alternativeData = new google.visualization.arrayToDataTable(altData);
            lc.draw(pwlData, lineOptions);
            tc.draw(alternativeData, tableOptions);

        }
        function init() {
            //pwlDataArray
            //console.log("origin: " + pwlDataArray);
            $("#lineChart_div").draggable();
            $("#tableChart_div").draggable();
            //$("#sliderControl_div").draggable();
            $("#sliderValDebug").hide();
            $("#elementSelect").selectmenu();
            $("#elementSubSelect").selectmenu();
            $("#sliderControl_div").slider({ slide: handleSlide, min: pwlDataArray[1][0], max: pwlDataArray[pwlDataArray.length - 1][0], step: 0.1 });
            $("#")
            lc = new google.visualization.ScatterChart(document.getElementById('lineChart_div'));
            tc = new google.visualization.Table(document.getElementById('tableChart_div'));
            draw();
        }

        function handleSlide(event, ui) {
            $("#sliderValDebug").html(ui.value);
            if (pointOld !== null)
                pwlDataArray.splice(pwlDataArray.indexOf(pointOld), 1);
            pointCurrent = [ui.value, 1, 'X'];
            //find current point position in pwlDataArray
            var i = 1;
            //console.log("i: " + i + "  uiVal: " + ui.value + "  pwlAt_i: " + pwlDataArray[pwlDataArray.length-1][0]);
            if (ui.value > pwlDataArray[pwlDataArray.length - 1][0]) {
                console.log("hrll");
                pwlDataArray.splice(pwlDataArray.length, 0, pointCurrent);
            }
            else {
                while (i < pwlDataArray.length) {
                    //console.log(i);

                    if (ui.value > pwlDataArray[i][0]) { i++; }
                    else {
                        //console.log("before: " + pwlDataArray);
                        pwlDataArray.splice(i, 0, pointCurrent); break;
                        //console.log("after: " + pwlDataArray);break; 
                    }

                }
            }
            var a = (pwlDataArray[i + 1][1] - pwlDataArray[i - 1][1]) / (pwlDataArray[i + 1][0] - pwlDataArray[i - 1][0]);
            var b = pwlDataArray[i + 1][1] - a * pwlDataArray[i + 1][0];
            pointCurrent[1] = a * pwlDataArray[i][0] + b;
            //pwlDataArray.push(pointCurrent);
            //console.log(pwlDataArray);
            pointOld = pointCurrent;
            draw();
        }

        $(document).ready(function () {
            var MareFrame = MareFrame || {};
            MareFrame.DST = MareFrame.DST || {};
            //new Mareframe.DST.Handler();
            //new Mareframe.DST.TestHandler();
        }); // end ready function

         
    </script>
</head>
<body>
    <div id="SenAna">
        <div class="senana" id="sliderControl_div"></div>
        <div class="senana" id="dropdownControl_div">
            <select id="elementSelect">
               
            </select>
        </div>
        <div class="senana" id="dropdownControlSub_div">
            <select id="elementSubSelect">
               
            </select>
        </div>
        <div class="senana" id="lineChart_div">Line Chart</div>
        <div class="senana" id="tableChart_div">Table Chart</div>

        <div class="senana" id="sliderControl_div"></div>
        <div class="senana" id="sliderValDebug">no val</div>
    </div>

    
</body>
</html>
